<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <meta charset="utf-8"/>
    <title>Urban Park Design Using Wave Function Collapse</title>
    <link rel="stylesheet" href="assets/styles/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
</head>

<body>
<div class="container">
    <div class="content">
        <div class="content-right">
            <div class="type-options">
                <h2 class="open-sans-700">Tile types:</h2>
                <div class="types" id="types"></div>
            </div>
        </div>

        <div class="content-center">
            <h1 class="bungee">ISOMETRIC PARK DESIGN</h1>
            <main></main>
            <div class="buttons">
                <button class="button open-sans-500" onclick="resetFunction()">Reset Function</button>
                <button class="button open-sans-500" onclick="resetEntireGrid()">Reset Grid</button>
                <button class="button open-sans-500" onclick="emptyGrid()">Empty Grid</button>
            </div>
        </div>

        <div class="content-left">
            <div class="cell-options scrollbar" id="cellOptions"></div>
        </div>
    </div>
</div>

<div class="footer">
    <h1 class="open-sans-700">Urban Park Design Using Wave Function Collapse</h1>
    <h2 class="open-sans-500">Description</h2>
</div>

<script src="cell.js"></script>
<script src="tile.js"></script>
<script src="sketch.js"></script>

<script>

    document.addEventListener("DOMContentLoaded", () => {
        if (jsonOptions && jsonOptions.options && jsonOptions.options.types) {
            initializeTypeOptions();
        } else {
            setTimeout(initializeTypeOptions, 1000); // Adjust the delay as needed
        }
    });

    function resetEntireGrid() {
        applyTypes();
        initializeGrid();
    }

    function resetFunction() {
        applyTypes();
        resetGrid();
        console.table(items)
    }

    function initializeTypeOptions() {
        let typesContainer = document.getElementById('types');
        jsonOptions.options.types.forEach(type => {

            let typeOption = document.createElement('label');
            typeOption.className = 'type-input';

            let input = document.createElement('input');
            input.type = 'checkbox';
            input.checked = type.used;

            let image = document.createElement('img');
            image.src = imageToDataURL(cropImage(type.image));

            typeOption.appendChild(input);
            typeOption.appendChild(image);
            typesContainer.appendChild(typeOption);
        })
    }

    function applyTypes() {
        const inputs = document.querySelectorAll('.types input');


        inputs.forEach((input, index) => {
            // Release the tiles that are being unchecked
            grid.forEach(cell => {
                if (cell.locked) {
                    if (cell.options[0].type === jsonOptions.options.types[index].name && !input.checked) {
                        cell.locked = false;
                        cell.removed = false;
                    }
                }
            })

            jsonOptions.options.types[index].used = input.checked;
        });

        // Update the global jsonOptions object with the modified copy
        jsonOptions.options.types.forEach((type, index) => {
            type.used = jsonOptions.options.types[index].used;
        });
    }

    function addElementToCellOptions(element, image) {
        const cellOptions = document.getElementById('cellOptions');

        const elementDiv = document.createElement('div');
        elementDiv.id = element;
        const elementImg = document.createElement('img');
        elementImg.src = image;

        elementDiv.appendChild(elementImg);
        cellOptions.appendChild(elementDiv);
        return elementDiv;
    }

    function emptyGrid() {
        resetGrid();
        grid.forEach((cell, index) => {
            grid[index] = new Cell([tiles[0]], cell.position, items);
        });
    }
</script>
</body>
</html>
