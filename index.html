<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <meta charset="utf-8"/>
    <title>Urban Park Design Using Wave Function Collapse</title>
    <style>
        .open-sans-700 {
            font-family: "Open Sans", sans-serif;
            font-optical-sizing: auto;
            font-weight: 700;
            font-style: normal;
        }

        .open-sans-500 {
            font-family: "Open Sans", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
        }

        button {
            font-size: 20px;
            background-color: #2fe7c5;
            border: none;
            color: white;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            border-radius: 100px;
            width: fit-content;
        }

        * {
            margin: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #fff;
        }

        .container {
            margin-top: 32px;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: flex-start;
            align-content: flex-start;
            flex-direction: column;
            text-align: center;
            gap: 16px;
        }

        .content-container {
            display: flex;
        }

        .sketch-container {
            width: fit-content;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .options-container {
            width: 768px;
            height: 640px;
        }

        .cell-options {
            width: 1152px;
            display: flex;
            flex-wrap: wrap;
        }

        .cell-options div img {
            width: 100px;
        }

    </style>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
          rel="stylesheet">
</head>

<body>
<div class="container">
    <h1 class="open-sans-700">Urban Park Design Using Wave Function Collapse</h1>
    <div class="content-container">
        <div class="sketch-container">
            <main style="width: fit-content; height: fit-content"></main>
            <div class="cell-options" id="cellOptions"></div>
        </div>
        <div class="options-container" id="optionsContainer">
            <div class="type-options">
                <h2 class="open-sans-700">Tile Types</h2>
                <div class="types" id="types"></div>
            </div>
        </div>
    </div>
    <button class="button open-sans-500" onclick="resetPage()">Reset Grid</button>
</div>

<script src="cell.js"></script>
<script src="tile.js"></script>
<script src="sketch.js"></script>

<script>

    document.addEventListener("DOMContentLoaded", () => {
        if (jsonOptions && jsonOptions.options && jsonOptions.options.types) {
            initializeTypeOptions();
        } else {
            setTimeout(initializeTypeOptions, 1000); // Adjust the delay as needed
        }
    });

    function resetPage() {
        applyTypes();
        resetGrid();
    }

    function initializeTypeOptions() {
        let typesContainer = document.getElementById('types');
        jsonOptions.options.types.forEach(type => {
            let typeDiv = document.createElement('div');
            typeDiv.innerHTML = `<h3 class="open-sans-700">${type.name}</h3>`;

            let typeOption = document.createElement('div');
            let image = document.createElement('img');
            image.src = imageToDataURL(cropImage(type.image));
            let input = document.createElement('input');
            input.type = 'checkbox';
            input.checked = type.used;
            typeOption.appendChild(image);
            typeOption.appendChild(input);
            typeDiv.appendChild(typeOption);
            typesContainer.appendChild(typeDiv);
        })
    }

    function applyTypes() {
        const inputs = document.querySelectorAll('.types input');

        inputs.forEach((input, index) => {
            jsonOptions.options.types[index].used = input.checked;
        });

        // Update the global jsonOptions object with the modified copy
        jsonOptions.options.types.forEach((type, index) => {
            type.used = jsonOptions.options.types[index].used;
        });
    }

    function addElementToCellOptions(element, image) {
        const cellOptions = document.getElementById('cellOptions');

        const elementDiv = document.createElement('div');
        elementDiv.id = element;
        const elementImg = document.createElement('img');
        elementImg.src = image;

        elementDiv.appendChild(elementImg);
        cellOptions.appendChild(elementDiv);
        return elementDiv;
    }
</script>
</body>
</html>
